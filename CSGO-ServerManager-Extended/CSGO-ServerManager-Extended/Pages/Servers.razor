@page "/servers"
@inject ICsgoServerService CsgoServerService
@inject ISnackbar Snackbar
@inject NavigationManager navigation

<MudTable Items="@csgoServers" Hover="true" Loading="@_loading" OnRowClick="RowClickEvent" T="ICsgoServer" RowStyle="cursor: pointer;" LoadingProgressColor="Color.Info" Striped="true" Elevation="4">
    <HeaderContent>
        <MudTh Style="font-weight: bold;">Name</MudTh>
        <MudTh Style="font-weight: bold;">Connection Ip</MudTh>
        <MudTh Style="font-weight: bold;">Status</MudTh>
        <MudTh Style="font-weight: bold;">Players online</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Name">@context.Name</MudTd>
        <MudTd DataLabel="Connection Ip" HideSmall="true">@context.GetConnectionIp()</MudTd>
        <MudTd DataLabel="Status">@context.GetStatus()</MudTd>
        <MudTd DataLabel="Players online">@context.PlayersOnline</MudTd>
    </RowTemplate>
</MudTable>

@code {
    private List<ICsgoServer> csgoServers = new();
    private bool _loading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            csgoServers.AddRange(await CsgoServerService.GetDatHostServers());
            _loading = false;
        }
        catch (Exception e)
        {
            Snackbar.Add(e.Message, Severity.Warning);
        }
    }

    private void RowClickEvent(TableRowClickEventArgs<ICsgoServer> args)
    {
        CsgoServerService.SelectedServerforNavigation = args.Item;
        navigation.NavigateTo("/server", true);
    }
}